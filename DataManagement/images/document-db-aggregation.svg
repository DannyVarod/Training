<svg width="1200" height="500" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .bg { fill: #1e1e1e; }
      .stage-box { fill: #2d3748; stroke: #4a90e2; stroke-width: 2; }
      .data-box { fill: #3d4852; stroke: #81c784; stroke-width: 2; }
      .stage-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; fill: #4a90e2; }
      .data-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: start; fill: #81c784; }
      .arrow { stroke: #4a90e2; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .title-text { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; text-anchor: middle; fill: #4a90e2; }
    </style>
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#4a90e2" />
      </marker>
    </defs>
  </defs>
  
  <!-- Dark background -->
  <rect x="0" y="0" width="1200" height="500" class="bg" />
  
  <!-- Title -->
  <text x="600" y="30" class="title-text">MongoDB Aggregation Pipeline</text>
  
  <!-- Stage 1: $match -->
  <rect x="50" y="80" width="180" height="60" class="stage-box" />
  <text x="140" y="105" class="stage-title">$match</text>
  <text x="140" y="125" style="font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #cbd5e0;">Filter documents</text>
  
  <!-- Stage 1 Data -->
  <rect x="50" y="160" width="180" height="280" class="data-box" />
  <text x="60" y="180" class="data-text">Input Documents:</text>
  <text x="60" y="200" class="data-text">{"name": "Alice", "age": 25}</text>
  <text x="60" y="220" class="data-text">{"name": "Bob", "age": 17}</text>
  <text x="60" y="240" class="data-text">{"name": "Carol", "age": 32}</text>
  <text x="60" y="260" class="data-text">{"name": "David", "age": 22}</text>
  <text x="60" y="280" class="data-text">{"name": "Emma", "age": 16}</text>
  <text x="60" y="300" class="data-text">{"name": "Frank", "age": 28}</text>
  
  <text x="60" y="320" style="font-family: Arial, sans-serif; font-size: 9px; text-anchor: start; fill: #ffc107;">Filter: age >= 18</text>
  <text x="60" y="340" style="font-family: Arial, sans-serif; font-size: 9px; text-anchor: start; fill: #dc3545;">Removed: Bob, Emma</text>
  
  <text x="60" y="360" class="data-text">Output: Alice, Carol, David, Frank</text>
  
  <!-- Arrow 1 -->
  <line x1="230" y1="110" x2="280" y2="110" class="arrow" />
  
  <!-- Stage 2: $group -->
  <rect x="300" y="80" width="180" height="60" class="stage-box" />
  <text x="390" y="105" class="stage-title">$group</text>
  <text x="390" y="125" style="font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #cbd5e0;">Group by age decade</text>
  
  <!-- Stage 2 Data -->
  <rect x="300" y="160" width="180" height="280" class="data-box" />
  <text x="310" y="180" style="font-family: Arial, sans-serif; font-size: 9px; text-anchor: start; fill: #ffc107;">Group by: Math.floor(age/10)</text>
  
  <text x="310" y="210" class="data-text">Group 2 (20s):</text>
  <text x="310" y="230" class="data-text">  _id: 2</text>
  <text x="310" y="250" class="data-text">  count: 3</text>
  <text x="310" y="270" class="data-text">  names: ["Alice", "David", "Frank"]</text>
  <text x="310" y="290" class="data-text">  avgAge: 25</text>
  
  <text x="310" y="320" class="data-text">Group 3 (30s):</text>
  <text x="310" y="340" class="data-text">  _id: 3</text>
  <text x="310" y="360" class="data-text">  count: 1</text>
  <text x="310" y="380" class="data-text">  names: ["Carol"]</text>
  <text x="310" y="400" class="data-text">  avgAge: 32</text>
  
  <!-- Arrow 2 -->
  <line x1="480" y1="110" x2="530" y2="110" class="arrow" />
  
  <!-- Stage 3: $project -->
  <rect x="550" y="80" width="180" height="60" class="stage-box" />
  <text x="640" y="105" class="stage-title">$project</text>
  <text x="640" y="125" style="font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #cbd5e0;">Shape output</text>
  
  <!-- Stage 3 Data -->
  <rect x="550" y="160" width="180" height="280" class="data-box" />
  <text x="560" y="180" style="font-family: Arial, sans-serif; font-size: 9px; text-anchor: start; fill: #ffc107;">Rename fields and format</text>
  
  <text x="560" y="210" class="data-text">{</text>
  <text x="570" y="230" class="data-text">ageGroup: "20s",</text>
  <text x="570" y="250" class="data-text">totalCount: 3,</text>
  <text x="570" y="270" class="data-text">averageAge: 25,</text>
  <text x="570" y="290" class="data-text">members: ["Alice", "David", "Frank"]</text>
  <text x="560" y="310" class="data-text">},</text>
  <text x="560" y="330" class="data-text">{</text>
  <text x="570" y="350" class="data-text">ageGroup: "30s",</text>
  <text x="570" y="370" class="data-text">totalCount: 1,</text>
  <text x="570" y="390" class="data-text">averageAge: 32,</text>
  <text x="570" y="410" class="data-text">members: ["Carol"]</text>
  <text x="560" y="430" class="data-text">}</text>
  
  <!-- Arrow 3 -->
  <line x1="730" y1="110" x2="780" y2="110" class="arrow" />
  
  <!-- Final Result -->
  <rect x="800" y="80" width="180" height="60" class="stage-box" />
  <text x="890" y="105" class="stage-title">Final Result</text>
  <text x="890" y="125" style="font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: #cbd5e0;">Aggregated data</text>
  
  <!-- Final Result Data -->
  <rect x="800" y="160" width="180" height="280" class="data-box" />
  <text x="810" y="180" style="font-family: Arial, sans-serif; font-size: 9px; text-anchor: start; fill: #81c784; font-weight: bold;">Final Output Array:</text>
  
  <text x="810" y="210" class="data-text">[</text>
  <text x="820" y="230" class="data-text">{</text>
  <text x="830" y="250" class="data-text">ageGroup: "20s",</text>
  <text x="830" y="270" class="data-text">totalCount: 3,</text>
  <text x="830" y="290" class="data-text">averageAge: 25</text>
  <text x="820" y="310" class="data-text">},</text>
  <text x="820" y="330" class="data-text">{</text>
  <text x="830" y="350" class="data-text">ageGroup: "30s",</text>
  <text x="830" y="370" class="data-text">totalCount: 1,</text>
  <text x="830" y="390" class="data-text">averageAge: 32</text>
  <text x="820" y="410" class="data-text">}</text>
  <text x="810" y="430" class="data-text">]</text>
  
  <!-- Pipeline flow label -->
  <text x="500" y="65" style="font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; fill: #4a90e2;">Data flows through pipeline stages</text>
</svg>
